!function(t){var s={};function i(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var a in t)i.d(e,a,function(s){return t[s]}.bind(null,a));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="/dist/",i(i.s=0)}([function(t,s,i){"use strict";function e(t){let s=0;for(let i=0;i<t.length;i++)s+=t[i];return s}function a(t,s,i){const e=t.getImageData(s,i,1,1);return[e.data[0],e.data[1],e.data[2]]}function h(t,s,i){return e(t.getImageData(s+23,i+23,2,2).data)}function r(t,s){return t=Math.ceil(t),s=Math.floor(s),Math.floor(Math.random()*(s-t))+t}function o(t,s){return t.x<s.x+s.width&&t.x+t.width>s.x&&t.y<s.y+s.height&&t.y+t.height>s.y}function n(t,s){let i=t.indexOf(s);i>-1&&t.splice(i,1)}function c(t){let s=t.toString(),i=[];for(let t=0;t<s.length;t++)i.push(parseInt(s[t]));return i}i.r(s);var l=class{constructor(){this.movement=[],this.attack=document.addEventListener("keyup",t=>this.onKeyUp(t)),document.addEventListener("keydown",t=>this.onKeyDown(t))}getInput(){return this.attack?(this.attack=!1,"attack"):this.movement[0]}onKeyDown(t){switch(t.keyCode){case 38:case 87:t.preventDefault(),this.movement.includes("up")||this.movement.unshift("up");break;case 39:case 68:t.preventDefault(),this.movement.includes("right")||this.movement.unshift("right");break;case 40:case 83:t.preventDefault(),this.movement.includes("down")||this.movement.unshift("down");break;case 37:case 65:t.preventDefault(),this.movement.includes("left")||this.movement.unshift("left");break;case 32:t.preventDefault(),this.fired||(this.attack=!0,this.fired=!0)}}onKeyUp(){switch(event.keyCode){case 38:case 87:n(this.movement,"up");break;case 39:case 68:n(this.movement,"right");break;case 40:case 83:n(this.movement,"down");break;case 37:case 65:n(this.movement,"left");break;case 32:this.fired=!1}}};var p=class{constructor(t){this.ctx=t,this.pos={x:0,y:0},this.image=new Image,this.image.src="./assets/images/ui/menu.png",this.heartSprite=new Image,this.heartSprite.src="./assets/images/items/hearts.png",this.numbers=new Image,this.numbers.src="./assets/images/ui/numbers.png",this.primaryitems=new Image,this.primaryitems.src="./assets/images/items/primaryItems.png",this.startPage=new Image,this.startPage.src="./assets/images/ui/start.png",this.deathPage=new Image,this.deathPage.src="./assets/images/ui/deathpage.png",this.marryPage=new Image,this.marryPage.src="./assets/images/ui/marry-2.png",this.winPage=new Image,this.winPage.src="./assets/images/ui/win.png",this.maxHearts=6,this.slotA=null,this.slotB=null,this.death=!1}renderMarryPage(){this.ctx.drawImage(this.marryPage,0,0)}renderWinPage(){console.log("ftw"),this.ctx.drawImage(this.winPage,0,0)}renderStartPage(){this.ctx.drawImage(this.startPage,0,0)}renderDeathPage(){!1===this.death&&(this.ctx.drawImage(this.deathPage,0,0),this.death=!0)}clearStartPage(){this.ctx.clearRect(0,0,768,696),this.render()}render(){this.ctx.drawImage(this.image,0,528,768,696,this.pos.x,this.pos.y,768,696),this.updateHearts(6),this.updateMiniMap({x:7,y:7}),this.updateMoney(0),this.updateKeys(0),this.updateBombCount(0),this.updateSlotA(0),this.updateSlotB()}updateHearts(t){this.ctx.fillStyle="black",this.ctx.fillRect(528,96,192,48);for(let s=0;s<this.maxHearts;s++)this.ctx.drawImage(this.heartSprite,s<t?24:72,0,24,24,528+24*s,96,24,24)}updateMiniMap(t){this.ctx.fillStyle="black",this.ctx.fillRect(48,24,192,48),this.ctx.fillStyle="grey",this.ctx.fillRect(48,48,192,96),this.ctx.fillStyle="#80D010",this.ctx.fillRect(51+12*t.x,48+12*t.y,9,9)}updateMoney(t){this.ctx.fillStyle="black",this.ctx.fillRect(312,48,48,24),c(t).forEach((t,s)=>{this.ctx.drawImage(this.numbers,0+24*t,0,24,24,312+24*s,48,24,24)})}updateKeys(t){this.ctx.fillStyle="black",this.ctx.fillRect(312,96,48,24),c(t).forEach((t,s)=>{this.ctx.drawImage(this.numbers,0+24*t,0,24,24,312+24*s,96,24,24)})}updateBombCount(t){this.ctx.fillStyle="black",this.ctx.fillRect(312,120,48,24),c(t).forEach((t,s)=>{this.ctx.drawImage(this.numbers,0+24*t,0,24,24,312+24*s,120,24,24)})}updateSlotA(t){this.ctx.fillStyle="black",this.ctx.fillRect(456,72,24,48),this.ctx.drawImage(this.primaryitems,0+24*t,0,24,48,456,72,24,48)}updateSlotB(t){this.ctx.fillStyle="black",this.ctx.fillRect(384,72,24,48)}};var m=class{constructor(t,s){this.ctx=s,this.sprite=new Image,this.sprite.src="./assets/images/player/attacks.png",this.swordSfx=new Audio("./assets/sfx/sword.wav"),this.swordSfx.play(),this.direction=t.direction,96===this.direction?(this.pos={x:t.x,y:t.y-36},this.hitBox={x:t.x+18,y:t.y-36,width:9,height:48}):144===this.direction?(this.pos={x:t.x+36,y:t.y},this.hitBox={x:t.x+36,y:t.y+24,width:48,height:9}):0===this.direction?(this.pos={x:t.x,y:t.y+36},this.hitBox={x:t.x+21,y:t.y+36,width:9,height:48}):48===this.direction&&(this.pos={x:t.x-36,y:t.y},this.hitBox={x:t.x-36,y:t.y+24,width:48,height:9})}clear(){this.ctx.clearRect(this.pos.x,this.pos.y,48,48)}step(){}draw(){this.ctx.drawImage(this.sprite,this.direction,0,48,48,this.pos.x,this.pos.y,48,48)}};var d=class{constructor(t){this.ctx=t,this.sprite=new Image,this.sprite.src="./assets/images/player/link.png",this.ouch=new Audio("./assets/sfx/link-hurt.wav"),this.pos={x:336,y:432,width:48,height:48,direction:0},this.hitbox={x:this.pos.x+12,y:this.pos.y+12,width:24,height:24},this.tracebox={topLeft:[this.pos.x+9,this.pos.y+24],topRight:[this.pos.x+39,this.pos.y+24],bottomLeft:[this.pos.x+9,this.pos.y+45],bottomRight:[this.pos.x+39,this.pos.y+45]},this.frames={run:0,attack:0,cooldown:0,invincibility:0,knockback:0},this.hp=6,this.attacks=[]}reset(){this.hp=6,this.attacks=[],this.pos={x:336,y:432,width:48,height:48,direction:0},this.hitbox={x:this.pos.x+12,y:this.pos.y+12,width:24,height:24},this.tracebox={topLeft:[this.pos.x+9,this.pos.y+24],topRight:[this.pos.x+39,this.pos.y+24],bottomLeft:[this.pos.x+9,this.pos.y+45],bottomRight:[this.pos.x+39,this.pos.y+45]},this.frames={run:0,attack:0,cooldown:0,invincibility:0,knockback:0}}clear(){this.ctx.clearRect(this.pos.x,this.pos.y,48,48)}step(){this.frames.run<=0&&(this.frames.run=16),this.frames.cooldown&&this.frames.cooldown--,this.frames.knockback&&this.frames.knockback--,this.frames.invincibility&&this.frames.invincibility--,this.frames.attack?this.frames.attack--:this.attacks.splice(0,1)}render(){this.hp<=0||(this.frames.attack&&this.frames.invincibility?this.drawImage(this.pos.direction+240,288+this.frames.invincibility%3*48):this.frames.attack&&!this.frames.invincibility?this.drawImage(this.pos.direction,96):!this.frames.attack&&this.frames.invincibility&&this.frames.run<9?this.drawImage(this.pos.direction+240,0+this.frames.invincibility%3*48):!this.frames.attack&&this.frames.invincibility&&this.frames.run>=9?this.drawImage(this.pos.direction+240,144):!this.frames.attack&&!this.frames.invincibility&&this.frames.run<9?this.drawImage(this.pos.direction,0):!this.frames.attack&&!this.frames.invincibility&&this.frames.run>=9&&this.drawImage(this.pos.direction,48))}drawImage(t,s){this.ctx.drawImage(this.sprite,t,s,48,48,this.pos.x,this.pos.y,48,48)}setDirection(t){switch(t){case"up":this.pos.direction=96;break;case"right":this.pos.direction=144;break;case"down":this.pos.direction=0;break;case"left":this.pos.direction=48}}move(t,s,i){this.hp<=0||this.frames.cooldown||(this.frames.run--,this.setDirection(i),this.pos.x+=t,this.pos.y+=s,this.hitbox.x+=t,this.hitbox.y+=s,this.tracebox.topLeft[0]+=t,this.tracebox.topLeft[1]+=s,this.tracebox.topRight[0]+=t,this.tracebox.topRight[1]+=s,this.tracebox.bottomLeft[0]+=t,this.tracebox.bottomLeft[1]+=s,this.tracebox.bottomRight[0]+=t,this.tracebox.bottomRight[1]+=s)}takeDamage(t=1){this.hp<=0||this.frames.invincibility||(Object.assign(this.frames,{invincibility:45,knockback:8}),this.ouch.play(),this.hp-=t,this.attacks.pop())}attack(){this.hp<=0||this.frames.cooldown||this.frames.knockback||(this.frames.cooldown=18,this.frames.attack=15,this.attacks.push(new m(this.pos,this.ctx)))}};var u=class{constructor(t,s){this.ctx=s,this.sprite=new Image,this.sprite.src="./assets/images/effects.png",this.pos={x:t[0],y:t[1],width:48,height:48},this.pixelPos=t,this.runCycle=r(20,150),this.frameData={invincibility:100}}takeDamage(){}clear(){this.ctx.clearRect(this.pos.x,this.pos.y,48,48)}step(){this.runCycle--}draw(){this.ctx.drawImage(this.sprite,this.runCycle>=8?0:48,0,48,48,this.pos.x,this.pos.y,48,48)}};var y=class{constructor(t,s){this.ctx=s,this.sprite=new Image,this.sprite.src="./assets/images/effects.png",this.pos={x:t.x,y:t.y,width:48,height:48},this.frameData={run:0,invincibility:100}}takeDamage(){}clear(){this.ctx.clearRect(this.pos.x,this.pos.y,48,48)}step(){this.frameData.run++}draw(){this.ctx.drawImage(this.sprite,96+48*Math.floor(this.frameData.run/2),0,48,48,this.pos.x,this.pos.y,48,48)}};var f=class{constructor(t,s,i,e){this.ctx=e,this.sprite=new Image,this.sprite.src="./assets/images/units/overworld-enemies.png",this.ouch=new Audio("./assets/sfx/hit-enemy.wav"),this.grid=s,this.pos={x:t[0],y:t[1],row:(t[1]-168)/48,col:t[0]/48,width:48,height:48},this.frameData={run:0,action:48,direction:0,frame:i,invincibility:0}}takeDamage(t=1){this.frameData.invincibility||(this.hp-=t,this.frameData.invincibility=20,this.ouch.play())}clear(){this.ctx.clearRect(this.pos.x,this.pos.y,48,48)}step(){this.frameData.invincibility&&this.frameData.invincibility--,this.frameData.action<=0&&this.updateAction(),96===this.frameData.direction?this.pos.y-=1*this.speed:144===this.frameData.direction?this.pos.x+=1*this.speed:0===this.frameData.direction?this.pos.y+=1*this.speed:48===this.frameData.direction&&(this.pos.x-=1*this.speed),this.frameData.run+=1*this.speed,this.frameData.action-=1*this.speed}draw(){let t=this.frameData.run<14?this.frameData.frame:this.frameData.frame+48;this.frameData.run>25&&(this.frameData.run=0),this.ctx.drawImage(this.sprite,this.frameData.direction,t,48,48,this.pos.x,this.pos.y,48,48)}checkAvailableActions(){let t=[];return this.pos.row>0&&1020===this.grid[this.pos.row-1][this.pos.col]&&t.push([96,0,-1]),1020===this.grid[this.pos.row][this.pos.col+1]&&t.push([144,1,0]),this.pos.row<10&&1020===this.grid[this.pos.row+1][this.pos.col]&&t.push([0,0,1]),1020===this.grid[this.pos.row][this.pos.col-1]&&t.push([48,-1,0]),t}updateAction(){let t=this.checkAvailableActions();this.frameData.action=48;let s=(i=t)[Math.floor(Math.random()*i.length)];var i;this.frameData.direction=s[0],this.pos.col+=s[1],this.pos.row+=s[2]}};var g=class extends f{constructor(t,s,i){let e=r(0,4);super(t,s,96*e,i),this.hp=0===e||2===e?1:2,this.speed=r(1,3),this.updateAction()}};var x=class{constructor(t,s){this.worldCtx=t,this.collisionCtx=s,this.overworld=new Image,this.overworld.src="./assets/images/maps/overworld.png",this.collisionMap=new Image,this.collisionMap.src="./assets/images/maps/overworld-collision.png",this.pos={x:5376,y:3528}}setLocation(t,s,i,e){}scroll(t){}getMapPos(){return{x:this.pos.x/768,y:(this.pos.y+168)/528}}render(){this.drawWorld(),this.drawCollisionMap()}drawWorld(){this.worldCtx.drawImage(this.overworld,this.pos.x,this.pos.y,768,696,0,0,768,696)}drawCollisionMap(){this.collisionCtx.drawImage(this.collisionMap,this.pos.x,this.pos.y,768,696,0,0,768,696)}};var w=class{constructor(t,s,i,e){this.hud=new p(t),this.player=new d(s),this.board=new x(i,e),this.spriteCtx=s,this.collisionCtx=e,this.startmusic=new Audio("./assets/sfx/overworldstart.ogg"),this.startmusic.volume=.2,this.music=new Audio("./assets/sfx/overworld.ogg"),this.music.volume=.2,this.lovemusic=new Audio("./assets/sfx/love.ogg"),this.lovemusic.volume=.2,this.unitDeath=new Audio("./assets/sfx/destroy-enemy.wav"),this.scrolling=!1,this.scrollQueue=0,this.units=[],this.grid=null,this.openSpaces=null,this.enemyCount=0,this.input=new l,this.muted=!1,this.live=!1,this.finalstage=!1,this.marryme=!1,document.addEventListener("keydown",t=>{13!==t.keyCode||this.live||(this.live=!0,this.hud.clearStartPage(),this.startmusic.play(),setTimeout(()=>{this.music.play(),this.music.loop=!0},6410)),this.player.hp<=0&&13===t.keyCode&&(this.destroyUnits(),this.player.reset(),this.board.pos={x:5376,y:3528},this.board.render(),this.hud.render(),this.player.render(),this.hud.clearStartPage(),this.hud.death=!1,this.startmusic.play(),setTimeout(()=>{this.music.play(),this.music.loop=!0},6410)),this.marryme&&13===t.keyCode&&this.hud.renderWinPage(),77===t.keyCode&&(this.muted?(this.startmusic.volume=.2,this.music.volume=.2,this.muted=!1):(this.startmusic.volume=0,this.music.volume=0,this.muted=!0))})}init(){this.board.render(),this.hud.render(),this.player.render(),this.hud.renderStartPage(),requestAnimationFrame(()=>this.gameLoop())}gameLoop(){this.clear(),this.step(this.collisionCtx),this.draw(),requestAnimationFrame(()=>this.gameLoop())}clear(){this.clearUnits(),this.clearAttacks(),this.player.clear()}step(t){this.checkBorder(),this.scroll(t),this.processInput(t),this.stepUnits(t),this.player.step()}draw(){this.player.hp<=0&&(this.hud.renderDeathPage(),this.music.pause(),this.music.currentTime=0),this.drawUnits(),this.drawAttacks(),this.player.render()}clearUnits(){this.units.forEach(t=>t.clear())}clearAttacks(){this.player.attacks.forEach(t=>t.clear())}stepUnits(t){this.player.frames.knockback&&this.knockBackPlayer(t),this.units.forEach((t,s)=>{t instanceof u&&t.runCycle<=0&&(this.units[s]=new g(t.pixelPos,this.grid,this.spriteCtx)),t.step(),this.checkCollisionsAgainstPlayer(t),this.player.attacks.forEach(s=>{o(s.hitBox,t.pos)&&this.damageUnit(t)})})}checkCollisionsAgainstPlayer(t){t instanceof u||t instanceof y||o(this.player.hitbox,t.pos)&&this.damagePlayer()}damagePlayer(t){this.player.hp<=0||(this.player.takeDamage(),this.hud.updateHearts(this.player.hp),this.player.hp<=0&&this.killPlayer())}killPlayer(){this.unitDeath.play(),this.units.push(new y(this.player.pos,this.spriteCtx))}damageUnit(t,s){t.takeDamage(s),t.hp<=0&&this.killUnit(t)}killUnit(t){this.unitDeath.play(),this.units.splice(this.units.indexOf(t),1),this.units.push(new y(t.pos,this.spriteCtx))}knockBackPlayer(t){let s=this.player.pos.direction,i=this.player.pos.x,e=this.player.pos.y;96===s&&e<634&&!this.impassableTerrain("down",t)?this.player.move(0,12):144===s&&i>14&&!this.impassableTerrain("left",t)?this.player.move(-12,0):0===s&&e>188&&!this.impassableTerrain("up",t)?this.player.move(0,-12):48===s&&i<706&&!this.impassableTerrain("right",t)&&this.player.move(12,0)}drawUnits(){this.units.forEach(t=>t.draw())}drawAttacks(){this.player.attacks.forEach(t=>t.draw())}scanGrid(t){let s=[],i=[];for(let e=168;e<696;e+=48){let a=[];for(let s=0;s<768;s+=48){let r=h(t,s,e);a.push(r),1020===r&&i.push([s,e])}s.push(a)}this.openSpaces=i,this.grid=s}setSpawns(){for(let t=0;t<this.enemyCount;t++){let t=this.openSpaces[Math.floor(Math.random()*this.openSpaces.length)];this.units.push(new u(t,this.spriteCtx))}}scroll(t){if(this.scrolling)if(this.scrollQueue<=0)this.hud.updateMiniMap(this.board.getMapPos()),this.scrolling=!1,this.board.drawCollisionMap(t),this.scanGrid(t),this.setSpawns();else{if(1952===this.board.pos.y&&2304===this.board.pos.x){this.finalstage=!0,this.lovemusic.play(),this.destroyUnits();var s=this;setTimeout((function(){s.destroyUnits()}),1e3),this.music.pause()}let t=this.player.pos.direction;96===t&&(this.board.pos.y-=8,this.scrollQueue>48&&this.player.move(0,8)),144===t&&(this.board.pos.x+=8,this.scrollQueue>48&&this.player.move(-8,0)),0===t&&(this.board.pos.y+=8,this.scrollQueue>48&&this.player.move(0,-8)),48===t&&(this.board.pos.x-=8,this.scrollQueue>48&&this.player.move(8,0)),this.scrollQueue-=8,this.board.drawWorld()}}checkBorder(){(this.player.pos.y<172||this.player.pos.y>648)&&(this.scrolling=!0,this.destroyUnits(),this.scrollQueue=528),(this.player.pos.x>720||this.player.pos.x<0)&&(this.scrolling=!0,this.destroyUnits(),this.scrollQueue=768),this.player.pos.x>=340&&this.player.pos.x<=400&&this.player.pos.y<490&&this.finalstage&&(this.marryme||(this.marryme=!0,this.hud.renderMarryPage()))}destroyUnits(){this.clearUnits(),this.units=[],this.enemyCount=r(1,6)}checkIfBarrier(t,s){let i=e(t),a=e(s);return 765===i||503===i||(765===a||503===a)}impassableTerrain(t,s){if("up"===t){const t=a(s,this.player.tracebox.topLeft[0],this.player.tracebox.topLeft[1]-3),i=a(s,this.player.tracebox.topRight[0],this.player.tracebox.topRight[1]-3);return this.checkIfBarrier(t,i)}if("right"===t){const t=a(s,this.player.tracebox.topRight[0]+3,this.player.tracebox.topRight[1]),i=a(s,this.player.tracebox.bottomRight[0]+3,this.player.tracebox.bottomRight[1]);return this.checkIfBarrier(t,i)}if("down"===t){const t=a(s,this.player.tracebox.bottomLeft[0],this.player.tracebox.bottomLeft[1]+3),i=a(s,this.player.tracebox.bottomRight[0],this.player.tracebox.bottomRight[1]+3);return this.checkIfBarrier(t,i)}if("left"===t){const t=a(s,this.player.tracebox.topLeft[0]-3,this.player.tracebox.topRight[1]),i=a(s,this.player.tracebox.bottomLeft[0]-3,this.player.tracebox.bottomLeft[1]);return this.checkIfBarrier(t,i)}}processInput(t){if(this.scrolling)return;if(!this.live)return;let s=this.input.getInput(),i=null;switch(s){case"attack":return void this.player.attack();case"up":i=this.impassableTerrain(s,t)?0:-4,this.player.move(0,i,s);break;case"right":i=this.impassableTerrain(s,t)?0:4,this.player.move(i,0,s);break;case"down":i=this.impassableTerrain(s,t)?0:4,this.player.move(0,i,s);break;case"left":i=this.impassableTerrain(s,t)?0:-4,this.player.move(i,0,s)}}};const b=document.getElementById("menu-canvas"),k=b.getContext("2d");b.width=768,b.height=696;const v=document.getElementById("sprite-canvas"),I=v.getContext("2d");v.width=768,v.height=696;const D=document.getElementById("map-canvas"),P=D.getContext("2d");D.width=768,D.height=696;const C=document.getElementById("collision-canvas"),S=C.getContext("2d");C.width=768,C.height=696;const R=new w(k,I,P,S);window.addEventListener("load",()=>{R.init()},!1)}]);
//# sourceMappingURL=bundle.js.map